# UI-Eye é¡¹ç›®æ¶æ„æ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

UI-Eye æ˜¯ä¸€ä¸ªåŸºäº AI çš„è§†è§‰å›å½’æµ‹è¯•å¹³å°ï¼Œæ”¯æŒæ‰¹é‡æˆªå›¾ã€åƒç´ çº§æ¯”å¯¹ã€AI è¯Šæ–­å’Œäº¤äº’è„šæœ¬æ‰§è¡Œã€‚

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„ï¼ˆåˆ†å±‚è§†å›¾ï¼‰

```mermaid
graph TD
    %% ç¬¬ä¸€å±‚ï¼šè¡¨ç°å±‚ - ç”¨æˆ·äº¤äº’ç•Œé¢
    subgraph L1["ğŸ“± è¡¨ç°å±‚ - ç”¨æˆ·äº¤äº’ç•Œé¢"]
        Web["ğŸŒ Vue 3 Web åº”ç”¨<br/>æ‰¹é‡ä»»åŠ¡ | å•æ¬¡å¯¹æ¯” | è„šæœ¬ç®¡ç†"]
        Plugin["ğŸ”Œ Chrome æµè§ˆå™¨æ’ä»¶<br/>å…ƒç´ é€‰æ‹© | å®æ—¶å¯¹æ¯”"]
    end
    
    %% ç¬¬äºŒå±‚ï¼šæ¥å£å±‚ - API ç½‘å…³å’Œå®æ—¶é€šä¿¡
    subgraph L2["ğŸ”— æ¥å£å±‚ - API ç½‘å…³å’Œå®æ—¶é€šä¿¡"]
        API["ğŸš€ Express REST API<br/>è·¯ç”± | æ§åˆ¶å™¨ | ä¸­é—´ä»¶"]
        WS["ğŸ“¡ WebSocket æœåŠ¡<br/>å®æ—¶è¿›åº¦æ¨é€"]
    end
    
    %% ç¬¬ä¸‰å±‚ï¼šåº”ç”¨å±‚ - ä¸šåŠ¡ç”¨ä¾‹ç¼–æ’
    subgraph L3["âš™ï¸ åº”ç”¨å±‚ - ä¸šåŠ¡ç”¨ä¾‹ç¼–æ’"]
        UC1["ğŸ“‹ æ‰¹é‡ä»»åŠ¡ç®¡ç†<br/>å¤š URL å¹¶å‘å¤„ç†"]
        UC2["ğŸ”„ å•æ¬¡å¯¹æ¯”æµç¨‹<br/>æˆªå›¾ â†’ æ¯”å¯¹ â†’ AI è¯Šæ–­"]
        UC3["ğŸ“ è„šæœ¬ç®¡ç†<br/>äº¤äº’è„šæœ¬ CRUD"]
    end
    
    %% ç¬¬å››å±‚ï¼šé¢†åŸŸå±‚ - æ ¸å¿ƒä¸šåŠ¡æ¨¡å‹
    subgraph L4["ğŸ’ é¢†åŸŸå±‚ - æ ¸å¿ƒä¸šåŠ¡æ¨¡å‹"]
        Model["ğŸ“¦ é¢†åŸŸæ¨¡å‹<br/>BatchTask | Script | Report"]
        Repo["ğŸ—‚ï¸ ä»“å‚¨æ¥å£<br/>æ•°æ®è®¿é—®æŠ½è±¡"]
    end
    
    %% ç¬¬äº”å±‚ï¼šåŸºç¡€è®¾æ–½å±‚ - æŠ€æœ¯å®ç°
    subgraph L5["ğŸ”§ åŸºç¡€è®¾æ–½å±‚ - æŠ€æœ¯å®ç°"]
        Capture["ğŸ“¸ æˆªå›¾å¼•æ“<br/>Playwright é€‚é…å™¨"]
        Compare["ğŸ” åƒç´ æ¯”å¯¹<br/>ODiff å¼•æ“"]
        AI["ğŸ¤– AI è¯Šæ–­<br/>SiliconFlow æä¾›è€…"]
        DB["ğŸ’¾ æ•°æ®æŒä¹…åŒ–<br/>SQLite ä»“å‚¨"]
        Storage["ğŸ“ æ–‡ä»¶å­˜å‚¨<br/>æˆªå›¾ | å·®å¼‚å›¾"]
    end
    
    %% ç¬¬å…­å±‚ï¼šå¤–éƒ¨ä¾èµ– - ç¬¬ä¸‰æ–¹æœåŠ¡
    subgraph L6["ğŸŒ å¤–éƒ¨ä¾èµ– - ç¬¬ä¸‰æ–¹æœåŠ¡"]
        Browser["ğŸŒ Playwright<br/>Chromium æµè§ˆå™¨"]
        AIService["â˜ï¸ SiliconFlow<br/>è§†è§‰ AI API"]
        FileSystem["ğŸ’¿ æ–‡ä»¶ç³»ç»Ÿ<br/>/data/uploads"]
        Database["ğŸ—„ï¸ SQLite<br/>ui-eye.db"]
    end
    
    %% å±‚çº§å…³ç³»
    Web --> API
    Plugin --> API
    API --> UC1
    API --> UC2
    API --> UC3
    WS -.å®æ—¶æ¨é€.-> Web
    
    UC1 --> Model
    UC2 --> Model
    UC3 --> Model
    UC1 --> Repo
    UC2 --> Repo
    UC3 --> Repo
    
    Repo --> DB
    UC1 --> Capture
    UC2 --> Capture
    UC2 --> Compare
    UC2 --> AI
    
    Capture --> Browser
    Compare --> Storage
    AI --> AIService
    DB --> Database
    Storage --> FileSystem
    
    %% æ ·å¼å®šä¹‰
    classDef layer1 fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef layer2 fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef layer3 fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    classDef layer4 fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef layer5 fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef layer6 fill:#e0f2f1,stroke:#00796b,stroke-width:2px
    
    class Web,Plugin layer1
    class API,WS layer2
    class UC1,UC2,UC3 layer3
    class Model,Repo layer4
    class Capture,Compare,AI,DB,Storage layer5
    class Browser,AIService,FileSystem,Database layer6
```

---

## ğŸ”„ æ‰¹é‡ä»»åŠ¡æ‰§è¡Œæµç¨‹

```mermaid
sequenceDiagram
    participant ç”¨æˆ·
    participant å‰ç«¯
    participant API
    participant æ‰¹é‡ä»»åŠ¡ç®¡ç†
    participant å¯¹æ¯”æµç¨‹
    participant Playwright
    participant åƒç´ æ¯”å¯¹
    participant AIè¯Šæ–­
    participant æ•°æ®åº“

    ç”¨æˆ·->>å‰ç«¯: åˆ›å»ºæ‰¹é‡ä»»åŠ¡
    å‰ç«¯->>API: POST /api/batch/tasks
    API->>æ‰¹é‡ä»»åŠ¡ç®¡ç†: åˆ›å»ºä»»åŠ¡
    æ‰¹é‡ä»»åŠ¡ç®¡ç†->>æ•°æ®åº“: ä¿å­˜ä»»åŠ¡
    æ•°æ®åº“-->>æ‰¹é‡ä»»åŠ¡ç®¡ç†: è¿”å›ä»»åŠ¡ID
    æ‰¹é‡ä»»åŠ¡ç®¡ç†-->>å‰ç«¯: ä»»åŠ¡åˆ›å»ºæˆåŠŸ
    
    ç”¨æˆ·->>å‰ç«¯: å¯åŠ¨ä»»åŠ¡
    å‰ç«¯->>API: POST /api/batch/tasks/:id/start
    API->>æ‰¹é‡ä»»åŠ¡ç®¡ç†: å¼€å§‹æ‰§è¡Œ
    
    loop éå†æ¯ä¸ª URL
        æ‰¹é‡ä»»åŠ¡ç®¡ç†->>å¯¹æ¯”æµç¨‹: æ‰§è¡Œå•ä¸ªå¯¹æ¯”ä»»åŠ¡
        
        Note over å¯¹æ¯”æµç¨‹: æ­¥éª¤1: ç¡®å®šè§†å£å®½åº¦
        å¯¹æ¯”æµç¨‹->>å¯¹æ¯”æµç¨‹: è§£æç”¨æˆ·é…ç½®
        
        Note over å¯¹æ¯”æµç¨‹: æ­¥éª¤2: æ‰§è¡Œæˆªå›¾
        å¯¹æ¯”æµç¨‹->>Playwright: å¯åŠ¨æµè§ˆå™¨å¹¶æˆªå›¾
        Playwright->>Playwright: è®¾ç½®è§†å£å’Œç§»åŠ¨ç«¯æ¨¡æ‹Ÿ
        Playwright->>Playwright: æ‰§è¡Œäº¤äº’è„šæœ¬(å¦‚ç™»å½•)
        Playwright->>Playwright: æˆªå–é¡µé¢
        Playwright-->>å¯¹æ¯”æµç¨‹: è¿”å›æˆªå›¾è·¯å¾„
        
        alt æœ‰è®¾è®¡ç¨¿
            Note over å¯¹æ¯”æµç¨‹: æ­¥éª¤3: åƒç´ æ¯”å¯¹
            å¯¹æ¯”æµç¨‹->>åƒç´ æ¯”å¯¹: å¯¹æ¯”è®¾è®¡ç¨¿å’Œå®é™…é¡µé¢
            åƒç´ æ¯”å¯¹->>åƒç´ æ¯”å¯¹: ODiff ç®—æ³•åˆ†æ
            åƒç´ æ¯”å¯¹-->>å¯¹æ¯”æµç¨‹: ç›¸ä¼¼åº¦ + å·®å¼‚å›¾
            
            Note over å¯¹æ¯”æµç¨‹: æ­¥éª¤4: AI è¯Šæ–­
            å¯¹æ¯”æµç¨‹->>AIè¯Šæ–­: åˆ†æå·®å¼‚åŸå› 
            AIè¯Šæ–­->>AIè¯Šæ–­: è°ƒç”¨ SiliconFlow API
            AIè¯Šæ–­-->>å¯¹æ¯”æµç¨‹: CSS ä¿®å¤å»ºè®®
        end
        
        å¯¹æ¯”æµç¨‹->>æ•°æ®åº“: ä¿å­˜æŠ¥å‘Š
        å¯¹æ¯”æµç¨‹-->>æ‰¹é‡ä»»åŠ¡ç®¡ç†: å®Œæˆ
        æ‰¹é‡ä»»åŠ¡ç®¡ç†->>å‰ç«¯: WebSocket æ¨é€è¿›åº¦
    end
    
    æ‰¹é‡ä»»åŠ¡ç®¡ç†->>æ•°æ®åº“: æ›´æ–°ä»»åŠ¡ç»Ÿè®¡
    æ‰¹é‡ä»»åŠ¡ç®¡ç†->>å‰ç«¯: WebSocket æ¨é€å®Œæˆ
    å‰ç«¯->>ç”¨æˆ·: æ˜¾ç¤ºç»“æœ
```

---

## ï¿½ å•æ¬¡å¯¹æ¯”ä»»åŠ¡æ‰§è¡Œæµç¨‹

```mermaid
sequenceDiagram
    participant ç”¨æˆ·
    participant å‰ç«¯
    participant API
    participant å¯¹æ¯”æµç¨‹
    participant Playwright
    participant åƒç´ æ¯”å¯¹
    participant AIè¯Šæ–­
    participant æ•°æ®åº“

    ç”¨æˆ·->>å‰ç«¯: è¾“å…¥ URL å’Œä¸Šä¼ è®¾è®¡ç¨¿
    å‰ç«¯->>API: POST /api/compare
    API->>å¯¹æ¯”æµç¨‹: åˆ›å»ºå¯¹æ¯”ä»»åŠ¡
    
    Note over å¯¹æ¯”æµç¨‹: æ­¥éª¤1: åˆå§‹åŒ–
    å¯¹æ¯”æµç¨‹->>æ•°æ®åº“: åˆ›å»ºæŠ¥å‘Šè®°å½•
    
    Note over å¯¹æ¯”æµç¨‹: æ­¥éª¤2: ç¡®å®šè§†å£
    å¯¹æ¯”æµç¨‹->>å¯¹æ¯”æµç¨‹: è§£æè®¾è®¡ç¨¿å°ºå¯¸
    
    Note over å¯¹æ¯”æµç¨‹: æ­¥éª¤3: æˆªå›¾
    å¯¹æ¯”æµç¨‹->>Playwright: å¯åŠ¨æµè§ˆå™¨
    Playwright->>Playwright: è®¾ç½®è§†å£
    Playwright->>Playwright: è®¿é—®ç›®æ ‡é¡µé¢
    Playwright->>Playwright: ç­‰å¾…åŠ è½½å®Œæˆ
    Playwright->>Playwright: å…¨å±æˆªå›¾
    Playwright-->>å¯¹æ¯”æµç¨‹: è¿”å›æˆªå›¾
    
    Note over å¯¹æ¯”æµç¨‹: æ­¥éª¤4: åƒç´ æ¯”å¯¹
    å¯¹æ¯”æµç¨‹->>åƒç´ æ¯”å¯¹: å¯¹æ¯”ä¸¤å¼ å›¾ç‰‡
    åƒç´ æ¯”å¯¹->>åƒç´ æ¯”å¯¹: å°ºå¯¸å¯¹é½
    åƒç´ æ¯”å¯¹->>åƒç´ æ¯”å¯¹: ODiff ç®—æ³•
    åƒç´ æ¯”å¯¹-->>å¯¹æ¯”æµç¨‹: ç›¸ä¼¼åº¦ + å·®å¼‚å›¾
    
    Note over å¯¹æ¯”æµç¨‹: æ­¥éª¤5: AI è¯Šæ–­
    å¯¹æ¯”æµç¨‹->>AIè¯Šæ–­: åˆ†æå·®å¼‚
    AIè¯Šæ–­->>AIè¯Šæ–­: å›¾åƒç¼–ç 
    AIè¯Šæ–­->>AIè¯Šæ–­: è°ƒç”¨ AI API
    AIè¯Šæ–­-->>å¯¹æ¯”æµç¨‹: CSS ä¿®å¤å»ºè®®
    
    Note over å¯¹æ¯”æµç¨‹: æ­¥éª¤6: ç”ŸæˆæŠ¥å‘Š
    å¯¹æ¯”æµç¨‹->>æ•°æ®åº“: ä¿å­˜å®Œæ•´æŠ¥å‘Š
    å¯¹æ¯”æµç¨‹-->>API: è¿”å›æŠ¥å‘ŠID
    API-->>å‰ç«¯: è¿”å›ç»“æœ
    å‰ç«¯->>ç”¨æˆ·: æ˜¾ç¤ºå¯¹æ¯”æŠ¥å‘Š
```

---

## ğŸ”Œ æµè§ˆå™¨æ’ä»¶æ‰§è¡Œæµç¨‹

```mermaid
sequenceDiagram
    participant ç”¨æˆ·
    participant æ’ä»¶å‰ç«¯
    participant Content Script
    participant é¡µé¢DOM
    participant API
    participant å¯¹æ¯”æµç¨‹
    participant AIè¯Šæ–­

    ç”¨æˆ·->>æ’ä»¶å‰ç«¯: æ‰“å¼€æ’ä»¶å¼¹çª—
    æ’ä»¶å‰ç«¯->>Content Script: æ³¨å…¥åˆ°å½“å‰é¡µé¢
    
    ç”¨æˆ·->>æ’ä»¶å‰ç«¯: ç‚¹å‡»é€‰æ‹©å…ƒç´ 
    æ’ä»¶å‰ç«¯->>Content Script: å¯åŠ¨å…ƒç´ é€‰æ‹©æ¨¡å¼
    Content Script->>é¡µé¢DOM: ç›‘å¬é¼ æ ‡äº‹ä»¶
    
    ç”¨æˆ·->>é¡µé¢DOM: é¼ æ ‡æ‚¬åœå…ƒç´ 
    é¡µé¢DOM->>Content Script: è§¦å‘ hover äº‹ä»¶
    Content Script->>é¡µé¢DOM: é«˜äº®æ˜¾ç¤ºå…ƒç´ 
    
    ç”¨æˆ·->>é¡µé¢DOM: ç‚¹å‡»é€‰æ‹©å…ƒç´ 
    é¡µé¢DOM->>Content Script: è§¦å‘ click äº‹ä»¶
    Content Script->>Content Script: æˆªå–å…ƒç´ åŒºåŸŸ
    Content Script->>Content Script: è·å–å…ƒç´ æ ·å¼
    Content Script-->>æ’ä»¶å‰ç«¯: è¿”å›æˆªå›¾å’Œæ ·å¼
    
    æ’ä»¶å‰ç«¯->>ç”¨æˆ·: æ˜¾ç¤ºæˆªå›¾é¢„è§ˆ
    
    ç”¨æˆ·->>æ’ä»¶å‰ç«¯: ä¸Šä¼ è®¾è®¡ç¨¿å¹¶æäº¤
    æ’ä»¶å‰ç«¯->>API: POST /api/compare
    API->>å¯¹æ¯”æµç¨‹: æ‰§è¡Œå¯¹æ¯”
    
    å¯¹æ¯”æµç¨‹->>å¯¹æ¯”æµç¨‹: åƒç´ æ¯”å¯¹
    å¯¹æ¯”æµç¨‹->>AIè¯Šæ–­: AI åˆ†æ
    AIè¯Šæ–­-->>å¯¹æ¯”æµç¨‹: è¿”å›è¯Šæ–­ç»“æœ
    
    å¯¹æ¯”æµç¨‹-->>API: è¿”å›æŠ¥å‘Š
    API-->>æ’ä»¶å‰ç«¯: è¿”å›ç»“æœ
    
    æ’ä»¶å‰ç«¯->>ç”¨æˆ·: æ˜¾ç¤ºå·®å¼‚å’Œä¿®å¤å»ºè®®
    
    alt ç”¨æˆ·é€‰æ‹©åº”ç”¨ä¿®å¤
        ç”¨æˆ·->>æ’ä»¶å‰ç«¯: ç‚¹å‡»åº”ç”¨ä¿®å¤
        æ’ä»¶å‰ç«¯->>Content Script: å‘é€ CSS ä¿®å¤ä»£ç 
        Content Script->>é¡µé¢DOM: åŠ¨æ€æ³¨å…¥æ ·å¼
        é¡µé¢DOM-->>ç”¨æˆ·: å®æ—¶é¢„è§ˆæ•ˆæœ
    end
```

---

## ğŸ“ é¡¹ç›®ç›®å½•ç»“æ„

```
UI-Eye/
â”œâ”€â”€ server/                          # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app.ts                   # Express åº”ç”¨å…¥å£
â”‚   â”‚   â”œâ”€â”€ index.ts                 # æœåŠ¡å™¨å¯åŠ¨å¼•å¯¼
â”‚   â”‚   â”œâ”€â”€ controllers/             # æ§åˆ¶å™¨å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ BatchController.ts
â”‚   â”‚   â”‚   â””â”€â”€ ScriptController.ts
â”‚   â”‚   â”œâ”€â”€ routes/                  # è·¯ç”±å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ batchRoutes.ts
â”‚   â”‚   â”‚   â””â”€â”€ scriptRoutes.ts
â”‚   â”‚   â”œâ”€â”€ application/             # åº”ç”¨å±‚ (Use Cases)
â”‚   â”‚   â”‚   â””â”€â”€ tasks/
â”‚   â”‚   â”‚       â”œâ”€â”€ ManageBatchTasksUseCase.ts
â”‚   â”‚   â”‚       â”œâ”€â”€ RunCompareUseCase.ts
â”‚   â”‚   â”‚       â””â”€â”€ ManageScriptsUseCase.ts
â”‚   â”‚   â”œâ”€â”€ domain/                  # é¢†åŸŸå±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ BatchTask.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Script.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Report.ts
â”‚   â”‚   â”‚   â””â”€â”€ repositories/
â”‚   â”‚   â”‚       â”œâ”€â”€ IBatchTaskRepository.ts
â”‚   â”‚   â”‚       â””â”€â”€ IScriptRepository.ts
â”‚   â”‚   â”œâ”€â”€ infrastructure/          # åŸºç¡€è®¾æ–½å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ adapters/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ PlaywrightCaptureAdapter.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ engines/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ODiffCompareEngine.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ ai/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SiliconFlowAIProvider.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SqliteBatchTaskRepository.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SqliteScriptRepository.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ di/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Container.ts     # ä¾èµ–æ³¨å…¥å®¹å™¨
â”‚   â”‚   â”‚   â””â”€â”€ ws/
â”‚   â”‚   â”‚       â””â”€â”€ WSServer.ts      # WebSocket æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”‚   â”œâ”€â”€ connection.ts        # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”‚   â””â”€â”€ schema.ts            # æ•°æ®åº“ Schema
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â””â”€â”€ PathUtils.ts
â”‚   â””â”€â”€ data/
â”‚       â””â”€â”€ uploads/                 # æˆªå›¾å­˜å‚¨ç›®å½•
â”œâ”€â”€ web/                             # å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”‚   â””â”€â”€ views/
â”‚   â”‚   â”‚       â”œâ”€â”€ BatchScreenshot.vue
â”‚   â”‚   â”‚       â”œâ”€â”€ BatchTaskDetail.vue
â”‚   â”‚   â”‚       â””â”€â”€ ScriptManagement.vue
â”‚   â”‚   â””â”€â”€ api/
â”‚   â”‚       â””â”€â”€ batchTask.ts
â”‚   â””â”€â”€ vite.config.ts
â”œâ”€â”€ extension/                       # æµè§ˆå™¨æ’ä»¶
â”‚   â”œâ”€â”€ popup.html
â”‚   â””â”€â”€ content.js
â””â”€â”€ docs/                            # æ–‡æ¡£
    â”œâ”€â”€ INTERACTIVE_SCRIPTS.md       # äº¤äº’è„šæœ¬æŒ‡å—
    â”œâ”€â”€ USER_GUIDE.md
    â””â”€â”€ ARCHITECTURE.md              # æœ¬æ–‡æ¡£
```

---

## ğŸ”§ æ ¸å¿ƒç»„ä»¶è¯´æ˜

### 1. PlaywrightCaptureAdapter

**èŒè´£**ï¼šä½¿ç”¨ Playwright æ‰§è¡Œé¡µé¢æˆªå›¾å’Œè„šæœ¬æ³¨å…¥

**å…³é”®åŠŸèƒ½**ï¼š
- å¯åŠ¨æ— å¤´æµè§ˆå™¨
- è®¾ç½®è§†å£å’Œç§»åŠ¨ç«¯æ¨¡æ‹Ÿ
- æ‰§è¡Œäº¤äº’è„šæœ¬ï¼ˆç™»å½•ã€æ¸…é™¤å¼¹çª—ç­‰ï¼‰
- æˆªå–å…¨å±æˆ–æŒ‡å®šåŒºåŸŸ

**ä»£ç ä½ç½®**ï¼š`server/src/infrastructure/adapters/PlaywrightCaptureAdapter.ts`

### 2. ManageBatchTasksUseCase

**èŒè´£**ï¼šæ‰¹é‡ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†

**å…³é”®åŠŸèƒ½**ï¼š
- åˆ›å»ºæ‰¹é‡ä»»åŠ¡
- å¹¶å‘æ‰§è¡Œå¤šä¸ª URL çš„æˆªå›¾å’Œæ¯”å¯¹
- å®æ—¶è¿›åº¦å¹¿æ’­ï¼ˆWebSocketï¼‰
- ä»»åŠ¡ç»Ÿè®¡å’Œèšåˆ

**ä»£ç ä½ç½®**ï¼š`server/src/application/tasks/ManageBatchTasksUseCase.ts`

### 3. RunCompareUseCase

**èŒè´£**ï¼šå•ä¸ª URL çš„å®Œæ•´æ¯”å¯¹æµç¨‹

**å…³é”®åŠŸèƒ½**ï¼š
- æˆªå›¾æ•è·
- åƒç´ çº§æ¯”å¯¹
- AI è¯Šæ–­
- æŠ¥å‘Šç”Ÿæˆ

**ä»£ç ä½ç½®**ï¼š`server/src/application/tasks/RunCompareUseCase.ts`

### 4. ODiffCompareEngine

**èŒè´£**ï¼šåƒç´ çº§å›¾åƒæ¯”å¯¹

**å…³é”®åŠŸèƒ½**ï¼š
- å°ºå¯¸å¯¹é½
- ODiff ç®—æ³•æ¯”å¯¹
- å·®å¼‚å›¾ç”Ÿæˆ
- ç›¸ä¼¼åº¦è®¡ç®—

**ä»£ç ä½ç½®**ï¼š`server/src/infrastructure/engines/ODiffCompareEngine.ts`

### 5. SiliconFlowAIProvider

**èŒè´£**ï¼šAI è§†è§‰è¯Šæ–­

**å…³é”®åŠŸèƒ½**ï¼š
- è°ƒç”¨ SiliconFlow API
- å›¾åƒç¼–ç å’Œä¸Šä¼ 
- å·®å¼‚åˆ†æ
- ä¿®å¤å»ºè®®ç”Ÿæˆ

**ä»£ç ä½ç½®**ï¼š`server/src/infrastructure/ai/SiliconFlowAIProvider.ts`

---

## ğŸ—„ï¸ æ•°æ®åº“ Schema

### batch_tasks è¡¨

| å­—æ®µ           | ç±»å‹    | è¯´æ˜                            |
| -------------- | ------- | ------------------------------- |
| id             | INTEGER | ä¸»é”®                            |
| name           | TEXT    | ä»»åŠ¡åç§°                        |
| urls           | TEXT    | URL åˆ—è¡¨ï¼ˆJSONï¼‰                |
| status         | TEXT    | ä»»åŠ¡çŠ¶æ€                        |
| compare_config | TEXT    | æ¯”å¯¹é…ç½®ï¼ˆJSONï¼ŒåŒ…å« viewportï¼‰ |
| script_id      | TEXT    | å…³è”çš„äº¤äº’è„šæœ¬ ID               |
| created_at     | INTEGER | åˆ›å»ºæ—¶é—´                        |

### scripts è¡¨

| å­—æ®µ        | ç±»å‹    | è¯´æ˜                |
| ----------- | ------- | ------------------- |
| id          | TEXT    | ä¸»é”®                |
| name        | TEXT    | è„šæœ¬åç§°            |
| code        | TEXT    | Playwright è„šæœ¬ä»£ç  |
| description | TEXT    | è„šæœ¬æè¿°            |
| created_at  | INTEGER | åˆ›å»ºæ—¶é—´            |

---

## ğŸ”Œ ä¾èµ–æ³¨å…¥å®¹å™¨

ä½¿ç”¨å•ä¾‹æ¨¡å¼ç®¡ç†æ‰€æœ‰æœåŠ¡çš„ç”Ÿå‘½å‘¨æœŸï¼š

```typescript
Container.getBatchTaskRepository()
Container.getScriptRepository()
Container.getCaptureAdapter()        // PlaywrightCaptureAdapter
Container.getCompareEngine()         // ODiffCompareEngine
Container.getAIProvider()            // SiliconFlowAIProvider
Container.getManageBatchTasksUseCase()
Container.getRunCompareUseCase()
```

**ä»£ç ä½ç½®**ï¼š`server/src/infrastructure/di/Container.ts`

---

## ğŸŒ API ç«¯ç‚¹

### æ‰¹é‡ä»»åŠ¡

- `POST /api/batch/tasks` - åˆ›å»ºæ‰¹é‡ä»»åŠ¡
- `POST /api/batch/tasks/:id/start` - å¯åŠ¨ä»»åŠ¡
- `GET /api/batch/tasks/:id` - è·å–ä»»åŠ¡è¯¦æƒ…
- `GET /api/batch/tasks` - è·å–ä»»åŠ¡åˆ—è¡¨

### äº¤äº’è„šæœ¬

- `POST /api/batch/scripts` - åˆ›å»ºè„šæœ¬
- `GET /api/batch/scripts` - è·å–è„šæœ¬åˆ—è¡¨
- `GET /api/batch/scripts/:id` - è·å–è„šæœ¬è¯¦æƒ…
- `PUT /api/batch/scripts/:id` - æ›´æ–°è„šæœ¬
- `DELETE /api/batch/scripts/:id` - åˆ é™¤è„šæœ¬

---

## ğŸ”„ WebSocket å®æ—¶é€šä¿¡

**ç«¯ç‚¹**ï¼š`ws://localhost:3000`

**äº‹ä»¶ç±»å‹**ï¼š
- `task:started` - ä»»åŠ¡å¼€å§‹
- `task:progress` - ä»»åŠ¡è¿›åº¦æ›´æ–°
- `task:completed` - ä»»åŠ¡å®Œæˆ

**æ•°æ®æ ¼å¼**ï¼š
```json
{
  "taskId": 123,
  "type": "task:progress",
  "data": {
    "current": 5,
    "total": 10,
    "progress": 50,
    "currentUrl": "https://example.com"
  }
}
```

---

## ğŸ¨ è®¾è®¡æ¨¡å¼

### 1. é¢†åŸŸé©±åŠ¨è®¾è®¡ (DDD)

- **Domain Layer**: ä¸šåŠ¡æ¨¡å‹å’Œæ¥å£å®šä¹‰
- **Application Layer**: ç”¨ä¾‹ç¼–æ’
- **Infrastructure Layer**: æŠ€æœ¯å®ç°

### 2. ä¾èµ–æ³¨å…¥ (DI)

- ä½¿ç”¨ Container ç®¡ç†ä¾èµ–
- æ¥å£ä¸å®ç°åˆ†ç¦»
- ä¾¿äºæµ‹è¯•å’Œæ›¿æ¢

### 3. é€‚é…å™¨æ¨¡å¼

- `PlaywrightCaptureAdapter` å®ç° `ICaptureAdapter`
- å¯è½»æ¾åˆ‡æ¢æˆªå›¾å¼•æ“

### 4. ä»“å‚¨æ¨¡å¼

- `SqliteBatchTaskRepository` å®ç° `IBatchTaskRepository`
- æ•°æ®è®¿é—®é€»è¾‘å°è£…

---

## ğŸš€ æŠ€æœ¯æ ˆ

### åç«¯
- **Node.js** + **TypeScript**
- **Express** - Web æ¡†æ¶
- **Playwright** - æµè§ˆå™¨è‡ªåŠ¨åŒ–
- **SQLite** - æ•°æ®åº“
- **WebSocket** - å®æ—¶é€šä¿¡
- **Sharp** - å›¾åƒå¤„ç†
- **ODiff** - åƒç´ æ¯”å¯¹

### å‰ç«¯
- **Vue 3** - UI æ¡†æ¶
- **Vite** - æ„å»ºå·¥å…·
- **Axios** - HTTP å®¢æˆ·ç«¯

### AI
- **SiliconFlow** - è§†è§‰ AI åˆ†æ

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

1. **å¹¶å‘æ§åˆ¶**ï¼šä½¿ç”¨ `p-limit` é™åˆ¶å¹¶å‘æ•°ï¼ˆé»˜è®¤ 3ï¼‰
2. **æ‡’åŠ è½½**ï¼šä¾èµ–æ³¨å…¥å®¹å™¨ä½¿ç”¨æ‡’åŠ è½½
3. **WebSocket**ï¼šå®æ—¶è¿›åº¦æ¨é€ï¼Œå‡å°‘è½®è¯¢
4. **å›¾åƒä¼˜åŒ–**ï¼šä½¿ç”¨ Sharp è¿›è¡Œé«˜æ•ˆå›¾åƒå¤„ç†

---

## ğŸ” å®‰å…¨è€ƒè™‘

1. **è„šæœ¬æ‰§è¡Œ**ï¼šåŠ¨æ€æ‰§è¡Œç”¨æˆ·è„šæœ¬éœ€è¦å®‰å…¨å®¡æŸ¥
2. **Cookie å­˜å‚¨**ï¼šå»ºè®®ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯
3. **API è®¤è¯**ï¼šç”Ÿäº§ç¯å¢ƒéœ€æ·»åŠ è®¤è¯æœºåˆ¶
4. **è¾“å…¥éªŒè¯**ï¼šå‰ç«¯å’Œåç«¯åŒé‡ URL æ ¼å¼æ ¡éªŒ

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [äº¤äº’è„šæœ¬ä½¿ç”¨æŒ‡å—](./INTERACTIVE_SCRIPTS.md)
- [ç”¨æˆ·æ‰‹å†Œ](./USER_GUIDE.md)
- [æµ‹è¯•æ–‡æ¡£](./TESTING.md)
